/mnt # ./rtsp_ori 
RTSP server START

        hostname is: (none)
        rtsp listening port is: 554
        Input rtsp://hostIP:554/test.264 to play this

listen for client connecting...
The pthread schedule_do start
s32ChnNum = 1
=============SAMPLE_COMM_VI_SetMipiAttr enWDRMode: 0
linear mode
Aptina AR0130 sensor 720P30fps init success!
AddClient, 123/////////////////////////////////////打印时可能会是fprintf(stderr, "%s, %d\n", __FUNCTION__, __LINE__);这样打印函数名和行号
Incoming RTSP connection accepted on socket: 17
EventLoop Connection reached: 3
192.168.1.101 Port:2299////////////////////////////////////////tcp_read函数里177行
INPUT_BUFFER was:OPTIONS rtsp://192.168.1.10/test.264 RTSP/1.0////////////////////////////////RtspServer函数1714行
CSeq: 2////////////////////////////////RtspServer函数1714行
User-Agent: LibVLC/2.2.6 (LIVE555 Streaming Media v2016.02.22)////////////////////////////////RtspServer函数1714行


rtsp_tracepoint: rtspservice.c,RTSP_state_machine,1368////////////////RTSP_state_machine函数1368行
state_machine:current state is  init state////////////////RTSP_state_machine函数1416行
current method code is:  3  ////////////////RTSP_state_machine函数1427行
OPTIONS rtsp://192.168.1.10/test.264 RTSP/1.0 /////////////////////////////RTSP_options函数888行
(Send to client:)/////////////////////////////////////bwrite函数385行
RTSP/1.0 200 OK///////////send_options_reply里填充，然后在bwrite打印
CSeq: 2///////////send_options_reply里填充，然后在bwrite打印
Public: OPTIONS,DESCRIBE,SETUP,PLAY,PAUSE,TEARDOWN///////////send_options_reply里填充，然后在bwrite打印


leaving rtsp_state_machine!///////////////////RTSP_state_machine函数1569行
exit Rtsp_state_machine///////////////////RTSP_handler函数1631行
4///////////////////RTSP_handler函数1635行
5//////////////////RtspServer函数1738行
192.168.1.101 Port:2299
INPUT_BUFFER was:DESCRIBE rtsp://192.168.1.10/test.264 RTSP/1.0
CSeq: 3
User-Agent: LibVLC/2.2.6 (LIVE555 Streaming Media v2016.02.22)
Accept: application/sdp


rtsp_tracepoint: rtspservice.c,RTSP_state_machine,1368
state_machine:current state is  init state
current method code is:  0  


GetSdpDescr,651===>psp.base64profileid=7d8bb7,psp.base64sps=0X2Lt7/k0PXC,psp.base64pps=whMx9P==

(Send to client:)
RTSP/1.0 200 OK
CSeq: 3
Server: sunshine/1.11
Date: Wed, 03 Jan 2018 22:28:53 GMT
Content-Type: application/sdp
Content-Base: rtsp://192.168.1.10/test.264/
Content-Length: 290

v=0
o=-3724007168 3724007168 IN IP4 192.168.1.10
s=Unnamed
i=N/A
c=IN IP4 192.168.1.101
t=0 0
a=recvonly
m=video 5004 RTP/AVP 96
b=RR:0
a=rtpmap:96 H264/90000
a=fmtp:96 packetization-mode=1;profile-level-id=7d8bb7;sprop-parameter-sets=0X2Lt7/k0PXC,whMx9P==;
a=control:trackID=0

leaving rtsp_state_machine!
exit Rtsp_state_machine
4
5
192.168.1.101 Port:2299
INPUT_BUFFER was:SETUP rtsp://192.168.1.10/test.264/trackID=0 RTSP/1.0
CSeq: 4
User-Agent: LibVLC/2.2.6 (LIVE555 Streaming Media v2016.02.22)
Transport: RTP/AVP;unicast;client_port=5004-5005


rtsp_tracepoint: rtspservice.c,RTSP_state_machine,1368
state_machine:current state is  init state
current method code is:  8  
*** transport: RTP/AVP;unicast;client_port=5004-5005 ***
<><><><>success creat RTP<><><><>
<><><><>Creat RTP<><><><>
pstr=-5005
**adding a schedule object action rtsputils.c,320**
(Send to client:)
RTSP/1.0 200 OK
CSeq: 4
Server: sunshine/1.11
Date: Wed, 03 Jan 2018 22:28:55 GMT
Session: 65643
Transport: RTP/AVP;unicast;client_port=5004-5005;destination=192.168.245.65;source=192.168.245.96;server_port=5004-5005


TRANSFER TO READY STATE!
leaving rtsp_state_machine!
exit Rtsp_state_machine
4
5
192.168.1.101 Port:2299
INPUT_BUFFER was:PLAY rtsp://192.168.1.10/test.264/ RTSP/1.0
CSeq: 5
User-Agent: LibVLC/2.2.6 (LIVE555 Streaming Media v2016.02.22)
Session: 65643
Range: npt=0.000-


rtsp_tracepoint: rtspservice.c,RTSP_state_machine,1368
state_machine:current state is  ready state
current method code is:5
        +++++++++++++++++++++
        start to play 0 now!
        +++++++++++++++++++++
(Send to client:)
RTSP/1.0 200 OK
CSeq: 5
Server: sunshine/1.11
Date: Wed, 03 Jan 2018 22:28:57 GMT
Session: 65643


        Start Playing!
leaving rtsp_state_machine!
exit Rtsp_state_machine
4
5
//////////////////////////////////////////这里以后就没有RTSP包了，就是服务器发H264包给客户端，客户端也没响应，
//直到客户端结束播放，发送RTSP的TEARDOWN
//播放过程：在SAMPLE_COMM_VENC_GetVencStreamProc函数里调用HisiPutH264DataToBuffer将数据流保存到ringfifo[iput].buffer里，
//然后在schedule_do线程里调用ringget(&ringinfo)读取数据流，然后对数据流添加时间戳等组成一个包用sched[i].play_action发送
//出去(sched[i].play_action是函数指针，实际上调用的是RtpSend函数(RtpSend-->SendNalu264-->sendto(socket里的发送函数),即
//RtpSend最终调用了sendto(socket里的发送函数)函数))

192.168.1.101 Port:2299
INPUT_BUFFER was:TEARDOWN rtsp://192.168.1.10/test.264/ RTSP/1.0
CSeq: 6
User-Agent: LibVLC/2.2.6 (LIVE555 Streaming Media v2016.02.22)
Session: 65643


rtsp_tracepoint: rtspservice.c,RTSP_state_machine,1368
state_machine:current state is  play state
(Send to client:)
RTSP/1.0 200 OK
CSeq: 6
Server: sunshine/1.11
Date: Wed, 03 Jan 2018 22:29:39 GMT
Session: 65643


no user online now resetfifo
leaving rtsp_state_machine!
exit Rtsp_state_machine
4
5
read() error rtspservice.c 1679///////////////////////1701行
(Send to client:)
RTSP/1.0 500 Internal Server Error
CSeq: 6


fd:17,RTSP connection closed by server.
first error,pRtsp is null
The pthread schedule_do end///////////////////////线程切换到schedule_do函数里
begin free mem////////////////////最后ringfree();释放
Segmentation fault////////////////////暂时不知道什么原因引起
